<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lucia Baby Log Input</title>
	<link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}">
	<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <h1>Lucia Baby Log Input</h1>
    <div class="form-group">
        <label for="time">Select Time: </label>
        <input type="datetime-local" id="time" name="time">
    </div>
    <div class="form-group">
       <select id="activity">
			<option value="" disabled selected>CHOOSE ACTIVITY</option>
			<option value="asleep">Asleep</option>
			<option value="awake">Awake</option>
			<option value="wet diaper">Wet Diaper</option>
			<option value="poo diaper">Poo Diaper</option>
			<option value="mixed diaper">Mixed Diaper</option>
			<option value="playing">Playing</option>
			<option value="feeding">Feeding</option>
			<option value="bathing">Bathing</option> 
		</select>
    </div>
    <div class="form-group">
        <input type="text" id="notes" placeholder="Add a short note (e.g., 60mL)">
    </div>
    
    <!-- Button group with equal-sized buttons in one row -->
    <div class="button-group">
        <button onclick="addActivity()">Add Activity</button>
        <button onclick="loadLog()">Refresh Log</button>
        <button onclick="sortLog()">Sort Log</button>
    </div>
    
	<!-- New button to edit the log -->
    <button id="edit-log-btn" class="edit-log-btn" onclick="toggleEditLog()">Edit Log</button>


    <div id="log"></div>
	<textarea id="log-textarea"></textarea>


    <script>
		let isEditing = false; // Track editing state

        // Function to toggle between viewing and editing the log
        function toggleEditLog() {
            const logElement = document.getElementById('log');
            const textarea = document.getElementById('log-textarea');
            const editLogBtn = document.getElementById('edit-log-btn');
            
            if (isEditing) {
                // Save the edited log
                const newLogContents = textarea.value;

                fetch('/update_log', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ log: newLogContents })
                }).then(response => response.json())
                  .then(data => {
                      if (data.success) {
                          loadLog(); // Reload log after saving
                      }
                  });

                // Switch back to view mode
                textarea.style.display = 'none';
                logElement.style.display = 'block';
                editLogBtn.textContent = 'Edit Log';
                editLogBtn.classList.remove('editing');
            } else {
                // Enter edit mode
                fetch('/get_log')
                    .then(response => response.json())
                    .then(data => {
                        textarea.value = data.log_entries.join('');
                    });

                textarea.style.display = 'block';
                logElement.style.display = 'none';
                editLogBtn.textContent = 'Finish Editing';
                editLogBtn.classList.add('editing');
            }

            isEditing = !isEditing; // Toggle editing state
        }
		
		
        // Function to fetch and display the log
        function loadLog() {
			console.log("Refreshing log.");
			
            fetch('/get_log')
                .then(response => response.json())
                .then(data => {
                    const logElement = document.getElementById('log');
                    logElement.innerHTML = data.log_entries.map(entry => `<div>${entry}</div>`).join('');
                });
        };
         
        function addActivity() {
			const time = document.getElementById('time').value;
			const activity = document.getElementById('activity').value;
			const notes = document.getElementById('notes').value;

			console.log("Time:", time);
			console.log("Activity:", activity);
			console.log("Notes:", notes);


			fetch('/add_activity', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json'
				},
				body: JSON.stringify({ time, activity, notes })
			}).then(response => response.json())
			  .then(data => {
				  if (data.success) {
					  document.getElementById('activity').selectedIndex = 0;
					  document.getElementById('notes').value = '';
				  }
			  })
			  .catch(error => {
				  console.error("Error adding activity:", error);
			  });
		}


        // New function to sort the log
        function sortLog() {
			console.log("Sorting log.")
            fetch('/sort_log', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            }).then(response => response.json())
              .then(data => {
                  if (data.success) {
					  console.log(data.message);
                      loadLog(); // Reload the log after sorting
                  }
              })
              .catch(error => {
                  console.error("Error sorting log:", error);
              });
        }
        
		console.log("Load log.")
        // Load the log when the page loads
        window.onload = loadLog;
    </script>
</body>
</html>
